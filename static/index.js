//  song dtatabase const BOLLYWOOD = [
//   { id: 1, name: "APNA BANALE", image: "songimg/bollywood/apnabanale.jpg", time: "05:00", theme: "BOLLYWOOD", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bollywood/APNABANALE.mp3" },
//   { id: 2, name: "Nazm Nazm", image: "songimg/bollywood/nazamnazam.jpeg", time: "05:00", theme: "BOLLYWOOD", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bollywood/NazmNazm.mp3" },
//   { id: 3, name: "Phir Bhi Tumko Chaahunga", image: "songimg/bollywood/phirbhitumkochaahunga.jpg", time: "05:00", theme: "BOLLYWOOD", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "PhirBhiTumkoChaahunga.mp3" },
//   { id: 4, name: "Tu Hai To Mujhe Fir Aur Kya Chahiye", image: "songimg/bollywood/PhirAurKyaChahiye.jpg", time: "05:00", theme: "BOLLYWOOD", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bollywood/TuHaiToMujheFirAurKyaChahiye.mp3" },
//   { id: 5, name: "Tum Hi Ho", image: "songimg/bollywood/tumhiho.jpg", time: "05:00", theme: "BOLLYWOOD", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bollywood/TumHiHo.mp3" },
// ];
// const ENGLISH = [
//   { id: 1, name: "Back To December Taylors", image: "songimg/english/backtodecembertaylors.png", time: "05:00", theme: "ENGLISH", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/english/BackToDecemberTaylors.mp3" },
//   { id: 2, name: "Olivia Rodrigo", image: "songimg/english/oliviarodrigo.jpeg", time: "05:00", theme: "ENGLISH", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/english/OliviaRodrigo.mp3" },
//   { id: 3, name: "Taylor Swift  Cruel Summer", image: "songimg/english/cruelsummer.jpeg", time: "05:00", theme: "ENGLISH", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/english/TaylorSwiftCruelSummer.mp3" },
//   { id: 4, name: "Taylor Swift  Style", image: "songimg/english/taylorswiftstyle.png", time: "05:00", theme: "ENGLISH", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/english/TaylorSwiftStyle.mp3" },
//   { id: 5, name: "Taylor Swift  You Belong With Me", image: "songimg/english/youbelongwithme.png", time: "05:00", theme: "ENGLISH", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/english/englishMe.mp3" },
// ];
// const BHOJPURI = [
//   { id: 1, name: "52 GAJ KA DAMAN", image: "songimg/bhojpuri/52GAJKADAMAN.jpeg", time: "05:00", theme: "BHOJPURI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bhojpuri/52GAJKADAMAN.mp3" },
//   { id: 2, name: "chunni mein chunni mein", image: "songimg/bhojpuri/chunnimeinchunnimein.jpg", time: "05:00", theme: "BHOJPURI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bhojpuri/chunnimeinchunnimein.mp3" },
//   { id: 3, name: "GYPSY Balam Thanedar", image: "songimg/bhojpuri/GYPSYBalamThanedar.jpeg", time: "05:00", theme: "BHOJPURI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bhojpuri/GYPSYBalamThanedar.mp3" },
//   { id: 4, name: "Lollypop Lagelu", image: "songimg/bhojpuri/LollypopLagelu.jpg", time: "05:00", theme: "BHOJPURI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bhojpuri/LollypopLagelu.mp3" },
//   { id: 5, name: "Teri Aakhya Ka Yo Kajal", image: "songimg/bhojpuri/TeriAakhyaKaYoKajal.jpg", time: "05:00", theme: "BHOJPURI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "themesongs/bhojpuri/TeriAakhyaKaYoKajal.mp3" },
// ];
// const PUNJABI = [
//   { id: 1, name: "Blue Eyes  Yo Yo Honey Singh", image: "songimg/punjabi/BlueEyesYoYoHoneySingh.jpeg", time: "05:00", theme: "PUNJABI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/punjabi/BlueEyesYoYoHoneySingh.mp3" },
//   { id: 2, name: "BROWN MUNDE AP DHILLON  GURINDER GILL  SHINDA KAHLON", image: "songimg/punjabi/BROWNMUNDE.jpg", time: "05:00", theme: "PUNJABI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/punjabi/BROWNMUNDEAPDHILLONGURINDERGILLSHINDAKAHLON.mp3" },
//   { id: 3, name: "Diljit Dosanjh  GOAT", image: "songimg/punjabi/DiljitDosanjhGOAT.jpg", time: "05:00", theme: "PUNJABI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/punjabi/DiljitDosanjhGOAT.mp3" },
//   { id: 4, name: "Harrdy Sandhu  Kya Baat Ay  Jaani  B Praak   Arvindr Khaira", image: "songimg/punjabi/HarrdySandhuKyaBaat.jpeg", time: "05:00", theme: "PUNJABI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/punjabi/HarrdySandhuKyaBaatAyJaaniBPraakArvindrKhaira.mp3" },
//   { id: 5, name: "OLD SKOOL Full Video Prem Dhillon ft Sidhu Moose Wala NseebRahul Chahal", image: "songimg/songimg/anime/", time: "05:00", theme: "PUNJABI", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/punjabi/OLDSKOOLFullVideoPremDhillonftSidhuMooseWalaNseebRahulChahal.mp3" },
// ];
// const ANIME = [
//   { id: 1, name: "Blue Bird", image: "songimg/anime/BlueBird.jpeg", time: "05:00", theme: "ANIME", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/anime/BlueBird.mp3" },
//   { id: 2, name: "Dream lantern", image: "songimg/anime/Dreamlantern.jpeg", time: "05:00", theme: "ANIME", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/anime/Dreamlantern.mp3" },
//   { id: 3, name: "nandemonaiya", image: "songimg/anime/Dreamlantern.jpeg", time: "05:00", theme: "ANIME", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/anime/nandemonaiya.mp3" },
//   { id: 4, name: "RADWIMPS", image: "songimg/anime/Dreamlantern.jpeg", time: "05:00", theme: "ANIME", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/anime/RADWIMPS.mp3" },
//   { id: 5, name: "Yoko Hikasa", image: "songimg/anime/Yoko Hikasa.jpeg", time: "05:00", theme: "ANIME", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/anime/YokoHikasa.mp3" },
// ];
// const KPOP = [
//   { id: 1, name: "ATEEZ에이티즈  멋The Real 흥  興", image: "songimg/kpop/thereal.jpg", time: "05:00", theme: "KPOP", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/kpop/ATEEZ에이티즈멋TheReal흥興.mp3" },
//   { id: 2, name: "BLACKPINK  Kill This Love MV", image: "songimg/kpop/KillThisLove.jpg", time: "05:00", theme: "KPOP", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/kpop/BLACKPINKKillThisLoveMV.mp3" },
//   { id: 3, name: "BTS Black Swan Official MV", image: "songimg/kpop/blackswan.jpg", time: "05:00", theme: "KPOP", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/kpop/BTSBlackSwanOfficialMV.mp3" },
//   { id: 4, name: "Fifty Fifty  Cupid Twin", image: "songimg/kpop/cupid.png", time: "05:00", theme: "KPOP", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/kpop/FiftyFiftyCupidTwin.mp3" },
//   { id: 5, name: "Growl MV Korean Ver", image: "songimg/kpop/GrowlMVKoreanVer.jpg", time: "05:00", theme: "KPOP", releasedata: "", malesinger: "", femalesinger: "", audioUrl: "/themesongs/kpop/GrowlMVKoreanVer.mp3" },
// ];
document.addEventListener('DOMContentLoaded', () => {
  const songInfoElement = document.getElementById('songInfo');
  const gridsongpicElement = document.querySelector('.gridsongpic img');
  const progressBar = document.getElementById("myProgressbar");
  const deleteButtons = document.querySelectorAll('.song-overlay form button');
  let isSeeking = false;
  const songs = []; // Initialize an empty array for storing the fetched songs

  async function fetchSongs(themeName) {
    try {
      const response = await fetch(`api/${themeName}`); // Replace '/songinfs' with the correct API endpoint URL
      console.log(response)
      // const response = await fetch('api/:theme'); // Replace '/songinfs' with the correct API endpoint URL
      const data = await response.json();
      songs.push(...data); // Add the fetched data to the songs array

      // Add event listeners to the play buttons after data is fetched
      songs.forEach(song => {
        const playButton = document.getElementById(`${song.id}.splay`);
        playButton.addEventListener('click', () => {
          updateSongInfo(song);
          playSong(song);

          // Optional: Scroll to the top of the container2 when a play button is clicked.
          songInfoElement.scrollTop = 0;
        });
      });

      // Load the first song on page load after data is fetched
      loadSong();
    } catch (error) {
      console.error('Error fetching songs:', error);
    }
  }
  const themeName = window.location.pathname.split('/').pop();
  fetchSongs(themeName);
  // Function to update the song details in container2
  function updateSongInfo(song) {
    const formattedSongInfo = `Name: ${song.name}\nTime: ${song.time}\nTheme: ${song.theme}\nRelease Date: ${song.releasedate}\nMale Singer: ${song.malesinger}\nFemale Singer: ${song.femalesinger}`;
    songInfoElement.textContent = formattedSongInfo;
    gridsongpicElement.src = song.image;
  }

  // deleteButtons.forEach((button) => {
  //   button.addEventListener('click', async (event) => {
  //     event.preventDefault();
  //     const songItem = event.target.parentElement;
  //     const songId = songItem.querySelector('img').id;

  //     try {
  //       // Send a delete request to the server to delete the song
  //       await fetch(`/deleteSong/${albumname}/${songId}`, { method: 'POST' });
  //       // Optionally, you can reload the page to update the song list
  //       window.location.reload();
  //     } catch (err) {
  //       console.error('Error deleting song:', err);
  //       // Handle the error as needed
  //     }
  //   });
  // });

  // Function to play the selected song
  function playSong(song) {
    audio.src = song.audioUrl;
    audio.play();
  }

  const backwardBtn = document.getElementById("masterBack");
  const playBtn = document.getElementById("masterPlay");
  const forwardBtn = document.getElementById("masterFront");
  const audio = new Audio();
  let currentSongIndex = 0;

  function loadSong() {
    const currentSong = songs[currentSongIndex];
    audio.src = currentSong.audioUrl;
    updateSongInfo(currentSong);
  }

  function playSong() {
    audio.play();
    playBtn.classList.remove("playchange");
    playBtn.classList.add("pausechange");
  }

  function pauseSong() {
    audio.pause();
    playBtn.classList.remove("pausechange");
    playBtn.classList.add("playchange");
  }

  function togglePlayPause() {
    if (audio.paused) {
      playSong();
    } else {
      pauseSong();
    }
  }

  function playPreviousSong() {
    currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
    loadSong();
    playSong();
  }

  function playNextSong() {
    currentSongIndex = (currentSongIndex + 1) % songs.length;
    loadSong();
    playSong();
  }

  backwardBtn.addEventListener("click", playPreviousSong);
  playBtn.addEventListener("click", togglePlayPause);
  forwardBtn.addEventListener("click", playNextSong);

  audio.addEventListener("ended", function () {
    pauseSong();
    currentSongIndex = (currentSongIndex + 1) % songs.length;
    loadSong();
    playSong();
  });

  // Update the progress bar position during audio playback
  audio.addEventListener("timeupdate", () => {
    updateProgressBar();
  });

  // Function to update the progress bar position
  function updateProgressBar() {
    if (!isSeeking && audio.duration > 0) {
      progressBar.value = (audio.currentTime / audio.duration) * 100;
    }
  }

  // Function to handle seeking when the user interacts with the progress bar
  function handleProgressBarSeek(e) {
    const seekPosition = (e.offsetX / progressBar.offsetWidth) * audio.duration;
    audio.currentTime = seekPosition;
    isSeeking = false;
    updateProgressBar();
  }

  progressBar.addEventListener("mousedown", () => {
    isSeeking = true;
  });

  progressBar.addEventListener("mouseup", (e) => {
    if (isSeeking) {
      handleProgressBarSeek(e);
    }
  });

  progressBar.addEventListener("mousemove", (e) => {
    if (isSeeking) {
      handleProgressBarSeek(e);
    }
  });

  // Load the first song on page load
  fetchSongs();
});
